<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'wasm-unsafe-eval' 'inline-speculation-rules' https://apis.google.com; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' http://localhost:* http://127.0.0.1:*; worker-src 'self' blob:; object-src 'none'; base-uri 'self'; frame-ancestors 'self'; frame-src https://apis.google.com;" />
  <title>PCWL</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='48' fill='%234c1d95'/%3E%3Ctext x='50' y='58' font-size='48' text-anchor='middle' fill='white' font-family='Segoe UI, Tahoma, sans-serif'%3EP%3C/text%3E%3C/svg%3E" />
  <link rel="stylesheet" href="assets/maplibre/maplibre-gl.css" />
  <link rel="stylesheet" href="styles.css" />
    <link rel="manifest" href="manifest.webmanifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PCWL">
    <link rel="apple-touch-icon" href="icons/icon-180.png">

</head>
<body>
  <button
    id="theme-toggle"
    class="theme-toggle"
    type="button"
    aria-pressed="false"
  >
    <span class="theme-toggle-track" aria-hidden="true">
      <span class="theme-toggle-thumb"></span>
    </span>
    <span class="theme-toggle-text">Dark mode</span>
  </button>
  <main class="app">
    <section id="welcome-screen" class="panel">
      <img src="data/Prague_Civil_War_Live.png" alt="PCWL" class="welcome-logo" />
      <form id="login-form" class="login-form" autocomplete="off">
        <label for="username-input">Username</label>
        <div class="login-row">
          <input type="text" id="username-input" name="username" placeholder="e.g. PCWL" maxlength="32" required />
        </div>
        <label for="password-input">Password</label>
        <div class="login-row">
          <input type="password" id="password-input" name="password" placeholder="At least 4 characters" minlength="4" required />
          <button type="submit" id="login-button" class="primary">Enter Prague</button>
        </div>
        <div class="remember-row">
          <label class="control checkbox remember-control">
            <input type="checkbox" id="remember-password-input" name="remember" />
            <span>Remember on this device</span>
          </label>
        </div>
        <p class="account-hint">
          Don't have an account?
          <a class="account-link" href="create-account.html">Create one here</a>
        </p>
        <div class="login-row login-help">
          <button type="button" id="howto-open" class="secondary">How to</button>
        </div>
      </form>
      <div id="known-players" class="known-players hidden">
        <h2>Jump back in</h2>
        <div id="known-players-list"></div>
      </div>
    </section>

    <section id="game-screen" class="panel hidden">
      <header class="top-bar">
        <div class="nav-group">
          <button id="find-me-button" class="primary">Find Me</button>
        </div>
        <div class="top-actions" aria-label="Quick actions">
          <div class="recent-tags" aria-live="polite">
            <span class="recent-tag" id="recent-checkin-1">No check-ins yet</span>
            <div class="user-shortcuts" role="group" aria-label="Player shortcuts">
              <button type="button" class="user-shortcut user-shortcut-primary" id="current-user-tag" aria-expanded="false">Guest</button>
              <button type="button" class="user-shortcut" id="friends-button">Friends</button>
              <button type="button" class="user-shortcut" id="district-button">District</button>
            </div>
          </div>
          <div id="cooldown-strip" class="cooldown-strip hidden" aria-live="polite"></div>
        </div>
        <div class="player-box">
        <div class="player-heading">
          <div class="player-identity">
            <h2 id="player-username">Username</h2>
            <button id="set-home-district-button" class="secondary small">Set Home</button>
          </div>
          <div class="player-actions">
            <button id="charge-attack-button" class="secondary small">Charge Attack</button>
            <button id="check-in-button" class="primary small">Check In</button>
          </div>
        </div>
        <div class="home-district-row">
          <span class="home-district-label">Home District:</span>
          <span id="home-district-value" class="home-district-value">Unset</span>
          <span id="home-presence-indicator" class="home-presence neutral">Unknown location</span>
        </div>
        <div id="dev-options" class="dev-options hidden">
          <label class="control checkbox">
            <input type="checkbox" id="dev-skip-cooldown" />
            <span>Skip cooldown</span>
          </label>
        </div>
        <div class="player-stats">
            <div class="stat">
              <span class="stat-label">Points</span>
              <span class="stat-value" id="player-points">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">Check-ins</span>
              <span class="stat-value" id="player-checkins-count">0</span>
            </div>
            <div class="stat">
              <span class="stat-label">A/D Ratio</span>
              <span class="stat-value" id="player-ad-ratio">—</span>
            </div>
          </div>
        </div>
      </header>
      <div class="layout">
        <div id="map"></div>
        <aside class="sidebar" id="mobile-drawer" aria-hidden="true">
          <header class="drawer-header mobile-only">
            <span class="drawer-title">Character &amp; Settings</span>
            <button id="drawer-close" class="icon-button" type="button" aria-label="Close panel">
              &times;
            </button>
          </header>
          <section class="drawer-block">
            <h2 class="drawer-heading">Character</h2>
            <div class="drawer-quick-actions">
              <button id="drawer-checkin-button" class="primary small" type="button">Check In</button>
              <button id="drawer-logout-button" class="secondary small" type="button">Log Out</button>
            </div>
          </section>
          <section class="drawer-block drawer-summary">
            <h2 class="drawer-heading">Player Info</h2>
            <div class="drawer-info">
              <div class="drawer-info-item">
                <span class="label">Player</span>
                <span class="value" id="drawer-player-username">Not signed in</span>
              </div>
              <div class="drawer-info-item">
                <span class="label">A/D Ratio</span>
                <span class="value" id="drawer-ad-ratio-summary">—</span>
              </div>
              <div class="drawer-info-item">
                <span class="label">Home strength</span>
                <span class="value" id="drawer-home-strength">—</span>
              </div>
              <div class="drawer-info-item">
                <span class="label">Home</span>
                <span class="value" id="drawer-home-summary">Not set</span>
              </div>
              <div class="drawer-info-item">
                <span class="label">Last known</span>
                <span class="value" id="drawer-location-summary">Unknown</span>
              </div>
            </div>
          </section>
          <section class="drawer-block layer-controls">
            <h2 class="drawer-heading">Layers</h2>
            <label class="control checkbox">
              <input type="checkbox" id="districts-toggle" checked />
              <span>Show districts</span>
            </label>
            <label class="control checkbox">
              <input type="checkbox" id="parks-toggle" checked />
              <span>Show parks</span>
            </label>
            <label class="control checkbox">
              <input type="checkbox" id="urban-toggle" checked />
              <span>Show urban planning</span>
            </label>
            <label class="control checkbox">
              <input type="checkbox" id="cycling-toggle" />
              <span>Show cycling routes</span>
            </label>
          </section>
          <section class="drawer-block">
            <h2 class="drawer-heading">Appearance</h2>
            <button id="drawer-theme-toggle" class="secondary small" type="button">Toggle Theme</button>
            <a id="drawer-leaderboard" class="secondary small button-link" href="leaderboard.html">Leaderboard</a>
          </section>
          <section class="drawer-block">
            <h2 class="drawer-heading">Audio</h2>
            <label class="control checkbox">
              <input type="checkbox" id="music-toggle" checked />
              <span>Background music</span>
            </label>
            <p class="music-track-label">Now playing: <span id="music-track-name">—</span></p>
            <label class="control slider">
              <span>Volume</span>
              <input type="range" id="music-volume" min="0" max="100" step="1" value="45" />
            </label>
            <div class="button-row">
              <button id="music-skip-button" class="secondary small" type="button">Skip Track</button>
            </div>
          </section>
          <section class="drawer-block">
            <h2 class="drawer-heading">Profile photo</h2>
            <div class="profile-photo-row">
              <img id="profile-image-preview" alt="Profile preview" class="avatar-preview" src="" />
              <div class="profile-photo-controls">
                <label class="control text">
                  <span>Image URL</span>
                  <input type="url" id="profile-image-url-input" placeholder="https://example.com/avatar.png" />
                </label>
                <div class="button-row">
                  <button id="profile-image-save" class="primary small" type="button" disabled>Save</button>
                  <button id="profile-image-clear" class="secondary small" type="button">Clear</button>
                </div>
                <div id="profile-image-feedback" class="help-text"></div>
              </div>
            </div>
          </section>
          <section class="drawer-block">
            <h2 class="drawer-heading">Home District</h2>
            <label class="control select control-home">
              <span>Select home district</span>
              <select id="drawer-home-select"></select>
            </label>
            <button id="drawer-home-save" class="primary small" type="button">Save Home</button>
          </section>
          <section class="drawer-block">
            <h2 class="drawer-heading">Activity</h2>
            <div id="status" class="drawer-status">Allow geolocation to begin.</div>
          </section>
          <section id="party-boost" class="drawer-block hidden" aria-hidden="true">
            <h2 class="drawer-heading">Party Boost</h2>
            <div id="party-boost-summary" class="drawer-status">Join a party to boost your actions together.</div>
            <ul id="party-boost-list" class="recent-checkins-list"></ul>
          </section>
          <section class="drawer-block how-it-works">
            <h2 class="drawer-heading">How to</h2>
            <details open>
              <summary class="how-summary">Quick guide to playing</summary>
              <div class="how-content">
                <h3>1) Set and represent your Home District</h3>
                <ul>
                  <li>Set your home via the “Set Home” button (desktop) or in Character &amp; Settings → Home District.</li>
                  <li>Defending happens when you check in at your home district. If you are away, you can still defend home using Remote Defend.</li>
                  <li>Your home gains points when you defend and loses ground when others attack it. Keep it secure!</li>
                </ul>
                <h3>2) Friends and Parties</h3>
                <ul>
                  <li>Open Friends to add players by username. You can favorite friends to keep them at the top.</li>
                  <li>Create a Party to play together. When at least two party members are in the same district, check-ins there can synchronize to everyone present.</li>
                  <li>Synced actions put nearby party members on cooldown labeled “Party attack”. Play together to multiply gains.</li>
                </ul>
                <h3>3) Attack or Defend</h3>
                <ul>
                  <li>Use the Check In button for a quick action based on where you are: attack other districts you’re in, or defend your home when you’re there.</li>
                  <li>On desktop, Right‑click the map to target a district; on mobile, Long‑press the map. This opens the context to launch a ranged attack (at other districts) or a precise local action.</li>
                  <li>Remote Defend: If you’re away from home, choose your home district to defend it remotely.</li>
                </ul>
                <h3>4) Charge and Cooldowns</h3>
                <ul>
                  <li>Tap “Charge Attack” to power up your next check‑in for extra points. It has its own cooldown.</li>
                  <li>Attacks, defends (local/remote), and charge have separate cooldowns. The strip at the top shows what’s cooling down and for how long.</li>
                </ul>
                <p class="how-tip">Tip: Enable geolocation for precise local actions, or use the map click/press to pick a district.</p>
              </div>
            </details>
          </section>
        </aside>
        <div id="drawer-overlay" class="drawer-overlay hidden" tabindex="-1" aria-hidden="true"></div>
        <button id="drawer-toggle" class="fab-button drawer-toggle mobile-only" type="button" aria-expanded="false" aria-controls="mobile-drawer">
          <span class="drawer-toggle-label">Character &amp; Settings</span>
          <span class="drawer-toggle-arrow" aria-hidden="true"></span>
        </button>
        <div class="mobile-bottom-actions mobile-only">
          <button id="mobile-find-me-button" class="fab-button fab-find" type="button">
            <span class="fab-label">Find Me</span>
          </button>
          <button id="settings-button" class="fab-button fab-settings" type="button">Character &amp; Settings</button>
          <button id="mobile-checkin-button" class="fab-button fab-checkin" type="button" aria-label="Check In">
            <img src="data/checkin.png" alt="" class="fab-icon" />
            <span class="sr-only">Check In</span>
          </button>
        </div>
      </div>
    </section>
  </main>

  <div id="recent-checkins-overlay" class="recent-checkins-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="recent-checkins-drawer" class="recent-checkins-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="recent-checkins-title">
    <div id="recent-checkins-content" class="recent-checkins-content" tabindex="-1">
      <header class="recent-checkins-header">
        <h2 id="recent-checkins-title">Recent Check-ins</h2>
        <button type="button" id="recent-checkins-close" class="icon-button recent-checkins-close" aria-label="Close recent check-ins drawer">
          &times;
        </button>
      </header>
      <div class="recent-checkins-body">
        <p id="recent-checkins-empty" class="recent-checkins-empty" hidden>No check-ins recorded yet.</p>
        <ul id="recent-checkins-list" class="recent-checkins-list" aria-live="polite"></ul>
        <button type="button" id="recent-checkins-toggle" class="secondary small recent-checkins-toggle hidden">Show more</button>
      </div>
    </div>
  </section>

  <div id="character-overlay" class="sheet-overlay character-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="character-drawer" class="sheet-drawer character-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="character-drawer-title">
    <div id="character-content" class="sheet-content" tabindex="-1">
      <header class="sheet-header">
        <h2 id="character-drawer-title">Character Profile</h2>
        <button type="button" id="character-close" class="icon-button sheet-close" aria-label="Close character drawer">
          &times;
        </button>
      </header>
      <div class="sheet-body">
        <section class="character-summary">
          <div class="character-avatar" aria-hidden="true">
            <span class="character-avatar-initial" id="character-avatar-initial">G</span>
          </div>
          <div class="character-meta">
            <h3 id="character-name">Guest</h3>
            <p id="character-tagline" class="character-tagline">Sign in to personalise your character.</p>
          </div>
        </section>
        <section class="character-customisation">
          <h3 class="character-section-title">Appearance</h3>
          <div class="character-color-control">
            <label class="character-color-label" for="marker-color-input">Map marker color</label>
            <div class="character-color-row">
              <input type="color" id="marker-color-input" value="#6366f1" />
              <button id="marker-color-reset" class="secondary small" type="button">Reset Color</button>
            </div>
            <p id="marker-color-feedback" class="help-text"></p>
          </div>
        </section>
        <section class="character-stats">
          <h3 class="character-section-title">Core Stats</h3>
          <div class="character-stats-grid">
            <div class="character-stat">
              <span class="label">Points</span>
              <span class="value" id="character-points">0</span>
            </div>
            <div class="character-stat">
              <span class="label">Level</span>
              <span class="value" id="character-level">1</span>
            </div>
            <div class="character-stat">
              <span class="label">Check-ins</span>
              <span class="value" id="character-checkins">0</span>
            </div>
            <div class="character-stat">
              <span class="label">Attack / Defend</span>
              <span class="value" id="character-ad">0 / 0</span>
            </div>
            <div class="character-stat">
              <span class="label">Charge Multiplier</span>
              <span class="value" id="character-charge">x1</span>
            </div>
            <div class="character-stat">
              <span class="label">Cooldown</span>
              <span class="value" id="character-cooldown">Ready</span>
            </div>
          </div>
        </section>
        <section class="character-interactions">
          <h3 class="character-section-title">Recent Interactions</h3>
          <p id="character-interactions-empty" class="character-empty">No interactions yet. Check in to build your story.</p>
          <ul id="character-interactions-list" class="character-interactions-list" hidden aria-live="polite"></ul>
        </section>
      </div>
    </div>
  </section>

  <div id="howto-overlay" class="sheet-overlay howto-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="howto-drawer" class="sheet-drawer howto-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="howto-title">
    <div id="howto-content" class="sheet-content" tabindex="-1">
      <header class="sheet-header">
        <h2 id="howto-title">How to</h2>
        <button type="button" id="howto-close" class="icon-button sheet-close" aria-label="Close help">
          &times;
        </button>
      </header>
      <div class="sheet-body">
        <section class="drawer-block how-it-works">
          <details open>
            <summary class="how-summary">Quick guide to playing</summary>
            <div class="how-content">
              <h3>1) Set and represent your Home District</h3>
              <ul>
                <li>Set your home via the “Set Home” button (desktop) or in Character &amp; Settings → Home District.</li>
                <li>Defending happens when you check in at your home district. If you are away, you can still defend home using Remote Defend.</li>
                <li>Your home gains points when you defend and loses ground when others attack it. Keep it secure!</li>
              </ul>
              <h3>2) Friends and Parties</h3>
              <ul>
                <li>Open Friends to add players by username. You can favorite friends to keep them at the top.</li>
                <li>Create a Party to play together. When you share a district, your actions sync and everyone present spends their cooldown together.</li>
                <li>Synced actions put nearby party members on cooldown labeled “Party attack”. Stay grouped to take repeated boosted turns.</li>
              </ul>
              <h3>3) Using Party Boost</h3>
              <ul>
                <li>Open Friends → Party and tap “Start Party” to begin a 3‑hour boost. Invite friends or accept their invites to fill your squad.</li>
                <li>You need at least two party members standing in the same district for the boost to trigger. Everyone present shares the reward and the cooldown.</li>
                <li>Solo check-ins pay the base 10 pts, but in a party every extra teammate adds x2 attack damage or x2.5 defend strength—up to x8/x10 with four friends—so sticking together beats playing alone.</li>
                <li>Any party member in the district can fire the check-in; when one of you taps it, everyone present cashes in the boost and goes on the shared cooldown.</li>
                <li>Party boost stacks with precise local actions (double again) and charged attacks (triple again), so plan bursts together while you’re all grouped up.</li>
              </ul>
              <h3>4) Attack or Defend</h3>
              <ul>
                <li>Use the Check In button for a quick action based on where you are: attack other districts you’re in, or defend your home when you’re there.</li>
                <li>On desktop, Right‑click the map to target a district; on mobile, Long‑press the map. This opens the context to launch a ranged attack (at other districts) or a precise local action.</li>
                <li>Remote Defend: If you’re away from home, choose your home district to defend it remotely.</li>
              </ul>
              <h3>5) Charge and Cooldowns</h3>
              <ul>
                <li>Tap “Charge Attack” to power up your next check‑in for extra points. It has its own cooldown.</li>
                <li>Attacks, defends (local/remote), and charge have separate cooldowns. The strip at the top shows what’s cooling down and for how long.</li>
              </ul>
              <h3>6) My Bubble</h3>
              <ul>
                <li>Open Friends → My Bubble to browse suggested allies drawn from your network.</li>
                <li>The drawer unlocks once you have friends; it fetches new recommendations and falls back to sharing your current roster if nothing fresh is available.</li>
                <li>Suggestions pull in friends-of-friends plus players you’ve recently partied with, ranking those with the most shared party time toward the top.</li>
                <li>Cards highlight each player’s home district, mutual friends, and party history so you can spot strong allies at a glance.</li>
                <li>Use “Add friend” to send a request directly from the bubble; shared entries are players you already have on the list.</li>
              </ul>
              <p class="how-tip">Tip: Enable geolocation for precise local actions, or use the map click/press to pick a district.</p>
            </div>
          </details>
          <details>
            <summary class="how-summary">Leaderboards and progress</summary>
            <div class="how-content">
              <h3>7) Global Leaderboards</h3>
              <ul>
                <li>Open the Leaderboard link in the tray to see live global rankings for both players and districts.</li>
                <li>The Player leaderboard totals every check-in you’ve made; scores update as soon as attacks/defends settle, with attack/defend columns showing the breakdown and the A/D ratio revealing your playstyle.</li>
                <li>District standings start from 2000 strength and rise when locals defend or fall when enemies attack. The ± columns show how much shifted, while Check-ins counts the total pressure on that district.</li>
                <li>Bringing friends to defend keeps your home high on the board; coordinated raids can knock rival districts down just as fast.</li>
              </ul>
            </div>
          </details>
        </section>
      </div>
    </div>
  </section>

  <div id="friends-overlay" class="sheet-overlay friends-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="friends-drawer" class="sheet-drawer friends-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="friends-drawer-title">
    <div id="friends-content" class="sheet-content" tabindex="-1">
      <header class="sheet-header">
        <h2 id="friends-drawer-title">Friends</h2>
        <button type="button" id="friends-close" class="icon-button sheet-close" aria-label="Close friends drawer">
          &times;
        </button>
      </header>
      <div class="sheet-body">
        <section id="friends-core-section" class="friends-section">
          <h3 class="friends-section-title">Your friends</h3>
          <p id="friends-empty" class="sheet-empty">Add friends to squad up and keep track of their progress.</p>
          <div id="friends-list" class="friends-list" hidden></div>
          <div class="friends-controls">
            <button type="button" id="friends-toggle-all" class="secondary small sheet-action friends-toggle" hidden>Show all friends</button>
            <button type="button" id="friends-manage-button" class="secondary small sheet-action">Manage Friends</button>
          </div>
        </section>
        <section id="friends-leaderboard" class="friends-leaderboard hidden" aria-live="polite" aria-label="Friend highlights">
          <h3 class="friend-leaderboard-heading">Squad Highlights</h3>
          <ul id="friends-leaderboard-list" class="friends-leaderboard-list"></ul>
          <p id="friends-leaderboard-hint" class="friends-leaderboard-hint hidden">Parties last 3 hours and boost shared check-ins.</p>
        </section>
        <section id="friends-party" class="friends-party hidden" aria-live="polite" aria-label="Party boost">
          <h3 class="friend-party-heading">Party Boost</h3>
          <p id="friends-party-status" class="friend-party-status">Sign in to start a party.</p>
          <div id="friends-party-chip" class="friend-party-chip"></div>
          <ul id="friends-party-members" class="friend-party-members"></ul>
          <div id="friends-party-invitations" class="friend-party-invitations hidden" aria-live="polite">
            <h4 class="friend-party-subheading">Invitations</h4>
            <ul id="friends-party-invite-incoming" class="friend-party-invite-list"></ul>
            <div id="friends-party-invite-outgoing" class="friend-party-invite-outgoing"></div>
          </div>
          <div class="friend-party-actions">
            <label class="sr-only" for="friends-party-select">Choose friend to party with</label>
            <select id="friends-party-select" class="friend-party-select"></select>
            <button type="button" id="friends-party-start" class="primary small">Start Party</button>
            <button type="button" id="friends-party-add" class="secondary small">Add Friend</button>
            <button type="button" id="friends-party-disband" class="secondary small danger">Disband</button>
          </div>
          <p class="friend-party-hint">Parties last 3 hours and then end automatically.</p>
        </section>
        <section id="friends-bubble-section" class="friends-section friends-bubble-section" aria-live="polite" aria-label="My bubble">
          <h3 class="friends-section-title">My bubble</h3>
          <p id="friends-bubble-subtitle" class="friends-section-subtitle">Friends-of-friends you may want to connect with.</p>
          <p id="friends-bubble-empty" class="sheet-empty">Sign in to discover your bubble.</p>
          <div id="friends-bubble-list" class="friends-list friends-bubble-list" hidden></div>
          <button type="button" id="friends-bubble-toggle" class="secondary small friends-bubble-toggle" hidden>Show more</button>
        </section>
        <div id="friends-manage-panel" class="friends-manage hidden" aria-hidden="true">
          <form id="friend-search-form" class="friend-search-form">
            <label class="sr-only" for="friend-search-input">Search username</label>
            <div class="friend-search-row">
              <input type="search" id="friend-search-input" class="friend-search-input" placeholder="Search username…" autocomplete="off" />
              <button type="submit" id="friend-search-button" class="primary small">Search</button>
            </div>
          </form>
          <div id="friend-search-feedback" class="friend-search-feedback" role="status" aria-live="polite"></div>
          <div id="friend-search-direct" class="friend-search-direct hidden">
            <button type="button" id="friend-search-add-direct" class="primary small">Send Friend Request</button>
          </div>
          <div id="friend-search-results" class="friend-search-results"></div>
          <div id="friend-requests-panel" class="friend-requests">
            <h3 class="friend-manage-heading">Friend requests</h3>
            <p id="friend-requests-feedback" class="friend-search-feedback" role="status" aria-live="polite"></p>
            <div class="friend-requests-groups">
              <div class="friend-requests-group">
                <h4>Incoming</h4>
                <p id="friend-requests-incoming-empty" class="friend-manage-empty">No pending requests.</p>
                <div id="friend-requests-incoming" class="friend-request-list"></div>
              </div>
              <div class="friend-requests-group">
                <h4>Sent</h4>
                <p id="friend-requests-outgoing-empty" class="friend-manage-empty">No sent requests.</p>
                <div id="friend-requests-outgoing" class="friend-request-list"></div>
              </div>
            </div>
          </div>
          <hr class="friend-manage-divider" />
          <h3 class="friend-manage-heading">Your friends</h3>
          <div id="friend-manage-list" class="friend-manage-list"></div>
          <button type="button" id="friend-manage-close" class="secondary small">Done</button>
        </div>
        <button type="button" id="friends-invite-button" class="secondary small sheet-action">Invite Friend</button>
      </div>
    </div>
  </section>

  <div id="friend-profile-overlay" class="sheet-overlay friend-profile-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="friend-profile-drawer" class="sheet-drawer friend-profile-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="friend-profile-title">
    <div id="friend-profile-content" class="sheet-content" tabindex="-1">
      <header class="sheet-header">
        <h2 id="friend-profile-title">Player Profile</h2>
        <button type="button" id="friend-profile-close" class="icon-button sheet-close" aria-label="Close friend profile drawer">
          &times;
        </button>
      </header>
      <div class="sheet-body">
        <div id="friend-profile-body" class="friend-profile-body"></div>
      </div>
    </div>
  </section>

  <div id="district-overlay" class="sheet-overlay district-overlay hidden" tabindex="-1" aria-hidden="true"></div>
  <section id="district-drawer" class="sheet-drawer district-drawer" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="district-drawer-title">
    <div id="district-content" class="sheet-content" tabindex="-1">
      <header class="sheet-header">
        <h2 id="district-drawer-title">District Hub</h2>
        <button type="button" id="district-close" class="icon-button sheet-close" aria-label="Close district drawer">
          &times;
        </button>
      </header>
      <div class="sheet-body">
        <div class="district-summary">
          <div class="district-summary-item">
            <span class="label">Home District</span>
            <span class="value" id="district-home-name">Not set</span>
          </div>
          <div class="district-summary-item">
            <span class="label">Contribution</span>
            <span class="value" id="district-contribution">0 pts • 0 local check-ins</span>
          </div>
          <div class="district-summary-item">
            <span class="label">Recent Activity</span>
            <span class="value" id="district-recent-activity">No check-ins yet</span>
          </div>
        </div>
        <div class="district-detail">
          <h3>Performance Snapshot</h3>
        <div class="district-leaderboard" id="district-leaderboard">
          <h3>District Leaderboard</h3>
          <p id="district-leaderboard-empty" class="district-leaderboard-empty">Set a home district to see player rankings.</p>
          <div class="district-leaderboard-group">
            <h4>Most Aggressive</h4>
            <ul id="district-leaderboard-aggressive" class="district-leaderboard-list"></ul>
          </div>
          <div class="district-leaderboard-group">
            <h4>Top Supporters</h4>
            <ul id="district-leaderboard-support" class="district-leaderboard-list"></ul>
          </div>
          <div class="district-leaderboard-highlights">
            <div class="district-highlight">
              <span class="district-highlight-label">Target District</span>
              <span class="district-highlight-value" id="district-target-value">—</span>
            </div>
            <div class="district-highlight">
              <span class="district-highlight-label">Threat District</span>
              <span class="district-highlight-value" id="district-threat-value">—</span>
            </div>
          </div>
        </div>

          <p id="district-performance-blurb">
            Sign in and set a home district to see how your team is doing.
          </p>
          <ul class="district-metrics">
            <li>
              <span class="metric-label">Check-ins recorded</span>
              <span class="metric-value" id="district-checkins-count">0</span>
            </li>
            <li>
              <span class="metric-label">Last contested</span>
              <span class="metric-value" id="district-last-contested">—</span>
            </li>
            <li>
              <span class="metric-label">Control status</span>
              <span class="metric-value" id="district-control-status">Unknown</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <div id="home-district-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="home-district-modal-title">
    <div id="home-district-modal-overlay" class="modal-overlay" tabindex="-1"></div>
    <div class="modal-content">
      <header class="modal-header">
        <h2 id="home-district-modal-title">Choose Home District</h2>
        <button type="button" id="home-district-modal-close" class="icon-button" aria-label="Close home district selector">
          &times;
        </button>
      </header>
      <div class="modal-body">
        <label for="home-district-search" class="sr-only">Search districts</label>
        <input type="search" id="home-district-search" class="modal-search" placeholder="Search districts…" autocomplete="off" />
        <div id="home-district-scroll" class="modal-scroll">
          <ul id="home-district-list" class="home-district-list" role="listbox" aria-labelledby="home-district-modal-title"></ul>
        </div>
      </div>
      <footer class="modal-footer">
        <button type="button" id="home-district-cancel" class="secondary">Cancel</button>
        <button type="button" id="home-district-confirm" class="primary" disabled>Set Home</button>
      </footer>
    </div>
  </div>

  <script src="assets/maplibre/maplibre-gl.js"></script>
  <script src="scripts/theme-toggle.js"></script>
  <script src="scripts/error-reporter.js"></script>
  <script src="scripts/topojson-client.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
